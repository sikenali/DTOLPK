# DTOLPK Electron 工具开发计划

## 1. 功能分析

根据现有代码，DTOLPK 是一个将 Docker Compose 文件转换为懒猫微服 LPK 应用包的工具，主要功能包括：

- 收集应用基本信息（名称、版本、描述、作者等）
- 配置应用功能（开机自启、多用户共享、公开路由等）
- 选择图标文件
- 选择 Docker Compose 文件
- 配置路由规则
- 处理镜像推送
- 配置服务构建
- 处理环境变量
- 配置卷挂载
- 配置健康检查
- 生成 LPK 应用包

## 2. 技术栈选择

- **Electron**：跨平台桌面应用框架
- **HTML5**：页面结构
- **Tailwind CSS**：样式框架（浅色主题）
- **FontAwesome**：图标库
- **JavaScript**：交互逻辑
- **Node.js**：后端处理

## 3. 项目结构

```
dtolpk-electron/
├── package.json          # 应用配置
├── main.js              # Electron 主进程
├── preload.js           # 预加载脚本（主进程与渲染进程通信）
├── index.html           # 主页面
├── css/
│   └── tailwind.css     # Tailwind CSS 样式（浅色主题）
├── js/
│   ├── renderer.js      # 渲染进程逻辑
│   ├── config.js        # 配置管理
│   ├── steps.js         # 步骤管理
│   ├── docker.js        # Docker 相关处理
│   └── lpk.js           # LPK 生成
├── assets/
│   └── icons/           # 图标资源
└── build/               # 构建配置
    ├── icon.ico         # 应用图标
    └── electron-builder.json  # 打包配置
```

## 4. 界面设计规划

### 4.1 整体布局
- 采用现代化的单页应用设计
- 左侧导航栏 + 右侧内容区
- 顶部状态栏显示应用信息和进度
- 使用卡片式布局展示不同配置项
- 响应式设计，适配不同屏幕尺寸
- **浅色主题**：采用明亮的背景色，清晰的文字对比

### 4.2 页面结构

1. **基本信息配置**（直接进入，去掉欢迎页面）
   - 应用名称、包名、版本
   - 描述、首页、作者
   - 不支持的平台选择
   - 系统版本要求

2. **应用功能选择**
   - 开机自启
   - 多用户共享
   - 公开路由
   - GPU加速、KVM加速、USB设备挂载
   - 文件关联

3. **资源选择**
   - 图标文件选择（使用 Electron 文件对话框）
   - Docker Compose 文件选择（使用 Electron 文件对话框）

4. **路由配置**
   - HTTP/HTTPS 路由配置
   - TCP/UDP 端口暴露
   - 从 Docker Compose 读取端口
   - 静态文件路由

5. **镜像配置**
   - 镜像推送目标选择
   - 自定义镜像仓库配置

6. **构建配置**
   - 服务构建选项
   - 构建上下文和 Dockerfile 配置

7. **高级配置**
   - 环境变量处理
   - 卷挂载配置
   - 健康检查配置

8. **生成 LPK 包**
   - 转换进度展示
   - 日志输出（实时更新）
   - 结果展示和保存路径选择

## 5. 核心功能实现

### 5.1 主进程（main.js）
- 窗口创建和管理
- 系统 API 调用（文件选择、进程管理等）
- 与渲染进程通信
- 应用生命周期管理

### 5.2 渲染进程（renderer.js）
- 页面渲染和用户交互
- 表单验证和数据收集
- 进度展示和日志输出
- 与主进程通信

### 5.3 预加载脚本（preload.js）
- 安全的进程间通信
- 暴露必要的 Node.js API 到渲染进程
- 保护渲染进程不受恶意代码攻击

### 5.4 核心模块

1. **文件选择模块**
   - 使用 Electron 的 `dialog` API 实现文件选择
   - 支持图标文件和 Docker Compose 文件选择
   - 支持目录选择

2. **配置管理模块**
   - 保存和加载用户配置
   - 验证配置数据
   - 处理配置变更

3. **Docker 处理模块**
   - 解析 Docker Compose 文件
   - 执行 Docker 命令（构建、推送等）
   - 处理 Docker 镜像

4. **LPK 生成模块**
   - 生成 manifest.yml
   - 创建 content.tar
   - 打包生成 LPK 文件

5. **进度管理模块**
   - 跟踪转换进度
   - 实时更新 UI
   - 处理错误和异常

## 6. 构建和打包

### 6.1 开发环境配置
- 安装 Node.js 和 npm
- 安装 Electron 依赖
- 配置开发脚本

### 6.2 打包配置
- 使用 `electron-builder` 进行打包
- 配置应用图标
- 配置打包选项（平台、架构等）
- 配置自动更新

### 6.3 分发格式
- Windows：.exe 安装包
- macOS：.dmg 安装包
- Linux：.deb 和 .rpm 包

## 7. 实现步骤

1. **项目初始化**
   - 创建 Electron 项目结构
   - 安装必要依赖
   - 配置 package.json

2. **主进程实现**
   - 创建窗口和菜单
   - 实现系统 API 调用
   - 配置进程间通信

3. **渲染进程实现**
   - 实现基本信息配置页面
   - 实现应用功能选择页面
   - 实现资源选择页面
   - 实现路由配置页面
   - 实现镜像配置页面
   - 实现构建配置页面
   - 实现高级配置页面
   - 实现生成 LPK 包页面

4. **样式设计**
   - 应用浅色主题
   - 实现响应式布局
   - 添加动画和过渡效果

5. **功能集成**
   - 集成 Docker 处理逻辑
   - 集成 LPK 生成逻辑
   - 实现进度跟踪和日志输出

6. **测试和调试**
   - 测试各个功能模块
   - 调试进程间通信
   - 测试文件选择和处理

7. **打包和分发**
   - 配置打包选项
   - 生成安装包
   - 测试安装和运行

## 8. 预期效果

- 现代化、直观的浅色主题界面
- 流畅的操作体验
- 清晰的步骤引导
- 实时的验证和反馈
- 详细的日志输出
- 支持所有原有命令行功能
- 跨平台支持（Windows、macOS、Linux）
- 易于安装和使用

## 9. 后续优化

- 支持配置保存和加载
- 添加批量转换功能
- 支持在线帮助和文档
- 添加错误处理和恢复机制
- 支持多语言
- 优化性能和启动速度
- 添加自动更新功能

现在我将开始实现这个 Electron 图形化应用，采用浅色主题，去掉欢迎界面，直接进入基本信息配置页面。